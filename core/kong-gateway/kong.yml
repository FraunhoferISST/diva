_format_version: "2.1"

services:
  - name: "Event-Service"
    protocol: http
    host: "172.17.0.1"
    port: 3009
    path: "/socket.io"
    routes:
      - name: event-route
        paths:
          - "/events"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]


  - name: "Resource-Management"
    protocol: http
    host: "172.17.0.1"
    port: 3000
    path: "/resources"
    routes:
      - name: resources-route
        paths:
          - "/resources"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]


  - name: "Asset-Management"
    protocol: http
    host: "172.17.0.1"
    port: 3002
    path: "/assets"
    routes:
      - name: assets-route
        paths:
          - "/assets"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "Reviews-Management"
    protocol: http
    host: "172.17.0.1"
    port: 3003
    path: "/reviews"
    routes:
      - name: reviews-route
        paths:
          - "/reviews"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "Service-Management"
    protocol: http
    host: "172.17.0.1"
    port: 3004
    path: "/services"
    routes:
      - name: services-route
        paths:
          - "/services"
        protocols:
          - "http"
          - "https"
        strip_path: true
        plugins:
          - name: jwt-keycloak
            config:
            allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

          - name: services-route-images
        methods:
          - POST
          - PUT
          - DELETE
          - OPTIONS
        paths:
          - "/serviceImages"
        protocols:
          - "http"
          - "https"
        strip_path: false
        plugins:
          - name: jwt-keycloak
            config:
              allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

      - name: services-route-get-images
        methods:
          - GET
        paths:
          - "/serviceImages"
        protocols:
          - "http"
          - "https"
        strip_path: false    

  - name: "Search-Assistant"
    protocol: http
    host: "172.17.0.1"
    port: 3005
    path: "/search"
    routes:
      - name: search-route
        paths:
          - "/search"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "Profiling-Assistant"
    protocol: http
    host: "172.17.0.1"
    port: 3011
    path: "/profiling"
    routes:
      - name: profiling-route
        paths:
          - "/profiling"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "History-Assistant"
    protocol: http
    host: "172.17.0.1"
    port: 3006
    path: "/histories"
    routes:
      - name: history-route
        paths:
          - "/histories"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "Analytics-Assistant"
    protocol: http
    host: "172.17.0.1"
    port: 3007
    path: "/analytics"
    routes:
      - name: analytics-route
        paths:
          - "/analytics"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "User-Management-Service"
    protocol: http
    host: "172.17.0.1"
    port: 3001
    path: "/"
    routes:
      - name: usermanagement-route
        paths:
          - "/users/"
        protocols:
          - "http"
          - "https"
        strip_path: false
        plugins:
          - name: jwt-keycloak
            config:
              allowed_iss: ["http://172.17.0.1:7000/auth/realms/diva-kc-realm"]

      - name: usermanagement-route-images
        methods:
          - POST
          - PUT
          - OPTIONS
        paths:
          - "/userImages"
        protocols:
          - "http"
          - "https"
        strip_path: false
        plugins:
          - name: jwt-keycloak
            config:
              allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

      - name: usermanagement-route-get-images
        methods:
          - GET
        paths:
          - "/userImages"
        protocols:
          - "http"
          - "https"
        strip_path: false
    plugins:
      - name: cors

  - name: "Diva-Lake-Adapter"
    protocol: http
    host: "172.17.0.1"
    port: 4001
    path: "/"
    routes:
      - name: diva-lake-adapter-route
        paths:
          - "/divaLakeAdapter"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "Urban-Pulse-Adapter"
    protocol: http
    host: "172.17.0.1"
    port: 4003
    path: "/"
    routes:
      - name: urban-pulse-adapter-route
        paths:
          - "/urbanPulseAdapter"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "DSC-Adapter"
    protocol: http
    host: "172.17.0.1"
    port: 4002
    path: "/"
    routes:
      - name: dsc-adapter-route
        paths:
          - "/dscAdapter"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva-kc-realm" ]

  - name: "Schema-Registry"
    protocol: http
    host: "172.17.0.1"
    port: 3010
    path: "/schemata"
    routes:
      - name: schema-registry-route
        paths:
          - "/schemata"
        protocols:
          - "http"
          - "https"
        strip_path: true

consumers:
  - username: web-client
    id: cbb297c0-14a9-46bc-ad91-1d0ef9b42df9
    basicauth_credentials:
      - username: "foo"
        password: 23d696aebd2ccacb9e5efb790baa1c72260f2ba7

plugins:
  - name: cors
    config:
      origins:
        - "*"
      preflight_continue: false
      credentials: false
