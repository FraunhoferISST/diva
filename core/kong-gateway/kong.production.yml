_format_version: "2.1"

services:
  - name: "Event-Emitter"
    url: "http://event-emitter:3009/socket.io"
    routes:
      - name: event-route
        paths:
          - "/events"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]


  - name: "Resource-Management"
    url: "http://resource-management:3000/resources"
    routes:
      - name: resources-route
        paths:
          - "/resources"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]


  - name: "Asset-Management"
    url: "http://asset-management:3002/assets"
    routes:
      - name: assets-route
        paths:
          - "/assets"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "Reviews-Management"
    url: "http://review-management:3003/reviews"
    routes:
      - name: reviews-route
        paths:
          - "/reviews"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "Search-Assistant"
    url: "http://search-assistant:3005/search"
    routes:
      - name: search-route
        paths:
          - "/search"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "Profiling-Assistant"
    url: "http://profiling-assistant:3011/profiling"
    routes:
      - name: profiling-route
        paths:
          - "/profiling"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "History-Assistant"
    url: "http://history-assistant:3006/histories"
    routes:
      - name: history-route
        paths:
          - "/histories"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "Analytics-Assistant"
    url: "http://analytics-assistant:3007/analytics"
    routes:
      - name: analytics-route
        paths:
          - "/analytics"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "User-Management-Service"
    url: "http://user-management:3001/"
    routes:
      - name: usermanagement-route
        paths:
          - "/users/"
        protocols:
          - "http"
          - "https"
        strip_path: false
        plugins:
          - name: jwt-keycloak
            config:
              allowed_iss: ["http://172.17.0.1:7000/auth/realms/diva"]

      - name: usermanagement-images-route
        methods:
          - POST
          - PUT
          - OPTIONS
        paths:
          - "/userImages"
        protocols:
          - "http"
          - "https"
        strip_path: false
        plugins:
          - name: jwt-keycloak
            config:
              allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

      - name: usermanagement-get-images-route
        methods:
          - GET
        paths:
          - "/userImages"
        protocols:
          - "http"
          - "https"
        strip_path: false
    plugins:
      - name: cors

  - name: "Diva-Lake-Adapter"
    url: "http://diva-lake-adapter:4001/"
    routes:
      - name: diva-lake-adapter-route
        paths:
          - "/divaLakeAdapter"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "Urban-Pulse-Adapter"
    url: "http://urban-pulse-adapter:4003/"
    routes:
      - name: urban-pulse-adapter-route
        paths:
          - "/urbanPulseAdapter"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "DSC-Adapter"
    url: "http://dsc-adapter:4002/"
    routes:
      - name: dsc-adapter-route
        paths:
          - "/dscAdapter"
        protocols:
          - "http"
          - "https"
        strip_path: true
    plugins:
      - name: jwt-keycloak
        config:
          allowed_iss: [ "http://172.17.0.1:7000/auth/realms/diva" ]

  - name: "Schema-Registry"
    url: "http://schema-registry:3010/schemata"
    routes:
      - name: schema-registry-route
        paths:
          - "/schemata"
        protocols:
          - "http"
          - "https"
        strip_path: true

consumers:
  - username: web-client
    id: cbb297c0-14a9-46bc-ad91-1d0ef9b42df9
    jwt_secrets:
      - key: "http://keycloak:8080/auth/realms/diva"
    basicauth_credentials:
      - username: "foo"
        password: 23d696aebd2ccacb9e5efb790baa1c72260f2ba7

plugins:
  - name: cors
    config:
      origins:
        - "*"
      preflight_continue: false
      credentials: false
